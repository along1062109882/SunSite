{extend name="base/base" /}
{block name="main"}
<form id="form" method="post" class="layui-form layui-form-pane" action="{:url('/admin/businessEdit')}">
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>選擇分類:</label>
        <div class="layui-input-inline">
            <select name="type" lay-verify="required">
                <?php foreach($grouplist as $key=>$val): ?>
                <option value="<?php echo $val['id']; ?>" <?php if(isset($list['type']) && $list['type']==$val['id']){echo "selected";} ?> > <?php echo $val['title']; ?></option>
                <?php endforeach; ?>
            </select>
            <!--{form:select name="group_id" list="$grouplist" value = "$list['group_id']"  default="[''=>'請選擇']"  option="['xm-select'=>'selectId','id'=>'group_id','lay-verify'=>'required']"}-->
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>slug:</label>
        <div class="layui-input-inline">
            <input type="text" name="slug" placeholder="這裡填寫url中的path" autocomplete="off" class="layui-input"
                   value="{:isset($list.slug)?$list.slug:''}" lay-verify="required">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>狀態:</label>
        <div class="layui-input-inline">
            <!--{form:radio name="status" list="['0'=>'草稿','1'=>'已發布']" value="$list['status']"}-->
            <select name="status" lay-verify="required">
                <option value="">請選擇狀態</option>
                <option value="0" <?php if(isset($list['status']) && $list['status']==0){echo "selected";} ?>>草稿</option>
                <option value="1" <?php if(isset($list['status']) && $list['status']==1){echo "selected";} ?>>已發布</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item flex-column">
    <label class="labels"><span class='Important'>*</span>發佈時間:</label>
        <div class="layui-input-inline">
            <input type="text" class="layui-input" id="test1" name="time" placeholder="請選擇日期" value="{:isset($list.time)?$list.time:''}" autocomplete="off" lay-verify="required">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>繁體標題:</label>
        <div class="layui-input-inline">
            <input type="text" name="title_hk" placeholder="請輸入" autocomplete="off" class="layui-input" lay-verify="required"
                   value="{:isset($list.title_hk)?$list.title_hk:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>繁體正文<span style="color: red">(粘貼文本後，請全選並點擊清除格式按鈕)</span>:</label>
        <div class="layui-input-inline">
            <textarea id="demo" style="display: none;" name="content_hk" value="{:isset($list.content_hk)?$list.content_hk:''}">{:isset($list.content_hk)?$list.content_hk:''}</textarea>
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">繁體预览:</label>
        <div class="layui-input-inline">
            <input type="text" name="show_hk" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.show_hk)?$list.show_hk:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">繁體 SEO Keywords:</label>
        <div class="layui-input-inline">
            <input type="text" name="keyword_hk" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.keyword_hk)?$list.keyword_hk:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">繁體 SEO Description:</label>
        <div class="layui-input-inline">
            <textarea class="layui-textarea" name="desc_hk" value="{:isset($list.desc_hk)?$list.desc_hk:''}">{:isset($list.desc_hk)?$list.desc_hk:''}</textarea>
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>簡體標題:</label>
        <div class="layui-input-inline">
            <input type="text" name="title_cn" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.title_cn)?$list.title_cn:''}" lay-verify="required">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels"><span class='Important'>*</span>簡體正文<span style="color: red">(粘貼文本後，請全選並點擊清除格式按鈕)</span>:</label>
        <div class="layui-input-inline">
            <textarea id="demo1" style="display: none;" required name="content_cn" value="{:isset($list.content_cn)?$list.content_cn:''}">{:isset($list.content_cn)?$list.content_cn:''}</textarea>
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">簡體预览:</label>
        <div class="layui-input-inline">
            <input type="text" name="show_cn" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.show_cn)?$list.show_cn:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">简體 SEO Keywords:</label>
        <div class="layui-input-inline">
            <input type="text" name="keyword_cn" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.keyword_cn)?$list.keyword_cn:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">简體 SEO Description:</label>
        <div class="layui-input-inline">
            <textarea class="layui-textarea" name="desc_cn" value="{:isset($list.desc_cn)?$list.desc_cn:''}">{:isset($list.desc_cn)?$list.desc_cn:''}</textarea>
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">英文標題:</label>
        <div class="layui-input-inline">
            <input type="text" name="title_en" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.title_en)?$list.title_en:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">英文正文<span style="color: red">(粘貼文本後，請全選並點擊清除格式按鈕)</span>:</label>
        <div class="layui-input-inline">
            <textarea id="demo2" style="display: none;" name="content_en" value="{:isset($list.content_en)?$list.content_en:''}">{:isset($list.content_en)?$list.content_en:''}</textarea>
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">英文预览:</label>
        <div class="layui-input-inline">
            <input type="text" name="show_en" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.show_en)?$list.show_en:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">英文 SEO Keywords:</label>
        <div class="layui-input-inline">
            <input type="text" name="keyword_en" placeholder="請輸入" autocomplete="off" class="layui-input"
                   value="{:isset($list.keyword_en)?$list.keyword_en:''}">
        </div>
    </div>
    <div class="layui-form-item flex-column">
        <label class="labels">英文 SEO Description:</label>
        <div class="layui-input-inline">
            <textarea class="layui-textarea" name="desc_en" value="{:isset($list.desc_en)?$list.desc_en:''}">{:isset($list.desc_en)?$list.desc_en:''}</textarea>
        </div>
    </div>

    <div class="layui-form-item flex-column">
        <div class="layui-input-inline">
            <input type="hidden" name="id" value="{:isset($list['id'])?$list['id']:''}">

            <button type="button" class="layui-btn" lay-submit lay-filter="*">發布</button>
            <!--<button type="reset" class="layui-btn layui-btn-primary">重置</button>-->
        </div>
    </div>
</form>
{/block}
{block name="script"}
{css href="/form-select/formSelects-v4.css" /}
<script>
    layui.config({
        base: '/form-select/' //此处路径请自行处理, 可以使用绝对路径
    }).extend({
        formSelects: 'formSelects-v4'
    });

    layui.use(['form', 'jquery', 'formSelects','layedit','laydate'], function () {
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem: '#test1' //指定元素
            ,type: 'datetime'
            ,trigger: 'click'
        });

        var layedit = layui.layedit;
        var demo = layedit.build('demo'); //建立编辑器
        var demo1 = layedit.build('demo1'); //建立编辑器
        var demo2 = layedit.build('demo2'); //建立编辑器

        var $ = layui.jquery,
            layer = layui.layer,
            form = layui.form;

        //表单提交
        form.on("submit(*)", function (data) {
            if(!layedit.getContent(demo)){
                parent.layer.msg('繁體內容不能为空',{icon:2});
                return false;
            }
            if(!layedit.getContent(demo1)){
                parent.layer.msg('簡體內容不能为空',{icon:2});
                return false;
            }
            data.field.content_hk = layedit.getContent(demo);
            data.field.content_cn = layedit.getContent(demo1);
            data.field.content_en = layedit.getContent(demo2);
            //ajax执行
            $.ajax({
                type: "post",
                url: '/admin/businessEdit',
                data:data.field,
                dataType: "json",
                success: function(data){
                    if(data.code===200){
                        parent.layer.msg('成功',{icon:1});
                        setTimeout(reload,0);
                    }else{
                        parent.layer.msg('失败',{icon:2});
                    }
                }
            });

            return false;
        });
    });
    function reload() {
        var index=parent.layer.getFrameIndex(window.name);//获取当前弹出层的层级
        window.parent.location.reload();//刷新父页面
        parent.layer.close(index);//关闭弹出层
    }
</script>
{/block}